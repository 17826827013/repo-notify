<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <#assign cmg = request.contextPath />
    <meta charset="UTF-8">
    <title>清分管理</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
</head>
<div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h4 class="modal-title">交易支付状态修改</h4>
</div>

<div class="modal-body">

    <form id="dmodalForm" class="form-horizontal">

        <div class="form-group">
            <label class="control-label col-sm-2">交易支付流水号:</label>
            <div class="col-sm-4">
                <input class="form-control" name="tradePayId" id="tradePayId" readOnly="readOnly" type="text" value="${tradePayId!''}"/>
                <input name="cancel" id="cancel" type="text" hidden="hidden" value="${cancel!''}"/>
            </div>
        </div>

        <div class="form-group">
            <label class="control-label col-sm-2">备注:</label>
            <div class="col-sm-4">
                <input class="form-control" name="remark" id="remark" type="text" value="${remark!''}"/>
            </div>

        </div>

    </form>

</div>

<div class="modal-footer">
    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
    <button type="button" class="btn btn-primary" id="submit">确认</button>
</div>




<script type="text/javascript">


    $("#submit").click(function () {

        var modalForm = $("#dmodalForm");
        var params = modalForm.serializeForm();

            var layerIndex;
            $.ajax({
                url: "${cmg}/clearing/clearingUpdate",
                data: params,
                timeout: 10000,
                type: "post",
                async: false,
                dataType:"json",
                beforeSend:function(){
                    layerIndex = layer.load(0, {shade: false});
                },
                success:function(result,row){
                    layer.close(layerIndex);
                    if(result.success){
                        layer.msg(result.msg);
                        setTimeout(function(){
                            $('#query').click();
                            $('#clearingEdit').modal('hide');
                        },500);
                    }else{
                        layer.msg(result.msg);
                    }
                },
                error:function (XMLHttpRequest, textStatus, errorThrown) {
                    layer.close(layerIndex);
                    XMLHttpRequest.abort();
                    if (textStatus == 'error') {
                        layer.msg("请求失败:" + errorThrown);
                    } else if (textStatus == 'timeout') {
                        layer.msg('请求超时');
                    } else {
                        layer.msg('status[' + textStatus + '] message:' + errorThrown)
                    }
                }
            })
        })





</script>
</html>